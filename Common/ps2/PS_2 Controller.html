<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0075)https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>PS/2 Controller</title><link rel="stylesheet" href="./PS_2 Controller_files/style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"></head><body><div class="article" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id438900"></a>PS/2 Controller</h2></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id470258">Introduction</a></span></dt><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id438734">Controller interface</a></span></dt><dd><dl><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id438740">Port Descriptions</a></span></dt><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id442295">Module parameters</a></span></dt><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#ifdesc">Interface description</a></span></dt></dl></dd><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id439258">PS/2 Keyboard protocol</a></span></dt><dd><dl><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id478856">Keyboard-to-Host communication</a></span></dt><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#hostkbdcomm">Host-to-Keyboard communication</a></span></dt></dl></dd><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousepr">PS/2 Mouse protocol</a></span></dt><dd><dl><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id479181">Mouse-to-host communication</a></span></dt><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id479420">Host-to-mouse communication</a></span></dt></dl></dd><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id479502">PS/2 Controller Demonstration</a></span></dt><dt><span class="bibliography"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id479527">Useful websites</a></span></dt><dt><span class="appendix"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#apkeycodes">A. List of key codes</a></span></dt><dd><dl><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id487726">Graphic keys-to-keycodes map</a></span></dt><dt><span class="section"><a href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#id505427">Keycode tables</a></span></dt></dl></dd></dl></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id470258"></a>Introduction</h2></div></div></div><p>The PS/2 controller can be used to communicate both with a PS/2
			keyboard and a PS/2 mouse. It provides an interface to the PS/2 protocol, handling the data transmission,
			error detection and the timing control.</p><p>The PS/2 controller interface consists of the PS/2 clock and the PS/2 data inputs, and two 8-bit data ports. One of the
			8-bit data ports is used for sending commands to the PS/2 device (mouse or keyboard), the other is for
			receiving data from the PS/2 device. There are also control signals provided to indicate the arrival of a
			new command from the PS/2 device and the status of the command transmission to the PS/2 device. The timing
			control necessary for the PS/2 communication is handled by the controller.</p><p>This document will describe the interface and operation of the PS/2 controller and give an overview of
			the PS/2 protocol.</p><p>You can download the source code (in Verilog) for the PS/2 controller <a class="ulink" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/src/PS2_Controller.zip" target="_top">here</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id438734"></a>Controller interface</h2></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id438740"></a>Port Descriptions</h3></div></div></div><div class="figure"><a id="figps2if"></a><p class="title"><b>Figure&nbsp;1.&nbsp;PS/2 Controller</b></p><div class="figure-contents"><a class="ulink" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/src/PS2_Controller.zip" target="_top">
					<div><img src="./PS_2 Controller_files/ps2interface.png" alt="PS/2 Controller"></div>
				</a></div></div><br class="figure-break"><p>The PS/2 controller interface is illustrated in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#figps2if" title="Figure 1. PS/2 Controller">Figure&nbsp;1, “PS/2 Controller”</a>, with inputs shown on the left, outputs on the right,
				and PS2_CLK and PS2_DAT lines being bidirectional. The blue lines are to be connected to the corresponding
				pins on the DE2 board, the green lines are used for receiving commands, and the red lines are used
				for sending commands. The red lines might be left unconnected if the user does not need
				to send the data to the PS/2 device. Ports are used as follows:</p><div class="itemizedlist"><p class="title"><b>Ports that must be connected:</b></p><ul type="disc"><li><p><code class="constant">CLOCK_50</code> - system clock input, must be 50MHz for the timing control to work properly.</p></li><li><p><code class="constant">reset</code> - the active-high reset.</p></li><li><p><code class="constant">PS2_CLK</code> and <code class="constant">PS2_DAT</code> - PS2 clock and data lines, respectively.
						These lines should be connected to the correspondingly named pins on the DE2 board, as defined in <a class="ulink" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/DE2_pin_assignments.csv" target="_top">this file</a>.</p></li><li><p><code class="constant">received_data</code> - last data received from the PS/2 bus. 8 bit word.</p></li><li><p><code class="constant">received_data_en</code> - new data signal. It is driven high for one clock cycle whenever a new
						data is received (i.e., <code class="constant">received_data</code> changes).</p></li></ul></div><div class="itemizedlist"><p class="title"><b>Optional ports:</b></p><ul type="disc"><li><p><code class="constant">the_command</code> - command to be sent, 8 bit input. Has to be valid on
						the same positive edge as when the <code class="constant">send_command</code> signal is first asserted.</p></li><li><p><code class="constant">send_command</code> - command ready signal, should be driven high for at
						least one clock cycle to start the transmission. This signal may be held high during the
						transmission, in which case the controller will wait for the signal to be de-asserted before
						entering the idle state (i.e., getting ready for another command). The transmission status
						signals (listed below) also hold their value from the current transmission until the
						<code class="constant">send_command</code> signal is de-asserted.</p></li><li><p><code class="constant">command_was_sent</code> - this signal is driven high once the command is successfully sent.</p></li><li><p><code class="constant">error_communication_timed_out</code> - indicates the transmission error
						when sending the command.</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id442295"></a>Module parameters</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>INITIALIZE_MOUSE</code></em> - if set to one, the controller will
						assume that the mouse is connected to the PS/2 port and initialize it to the
						<a class="link" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousepr" title="PS/2 Mouse protocol">streaming mode</a>. The initialization circuitry just enables the
						data reporting as described in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousepr" title="PS/2 Mouse protocol">the section called “PS/2 Mouse protocol”</a> and then relinquishes the command out
						lines back to the user. The initialization is done every time the controller is reset.</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ifdesc"></a>Interface description</h3></div></div></div><p>The controller interface consists of two parts: command-in and command-out.  If using the optional
				command lines to send commands to the PS2/device, the command output will always take a precedence over
				the command input.</p><p>The commands are received automatically, and the most recent command is stored in the register
				connected to the <code class="constant">received_data</code> port. The signal
				<code class="constant">received_data_en</code> is driven high for one clock cycle whenever a new command is
				received. The protocol timing is illustrated in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#figps2recv" title="Figure 2. Timing diagram for receiving commands">Figure&nbsp;2, “Timing diagram for receiving commands”</a>.</p><div class="figure"><a id="figps2recv"></a><p class="title"><b>Figure&nbsp;2.&nbsp;Timing diagram for receiving commands</b></p><div class="figure-contents"><div><img src="./PS_2 Controller_files/ps2_recv.png" alt="Timing diagram for receiving commands"></div></div></div><br class="figure-break"><p>PS/2 commands may be sent using the four command-out ports: <code class="constant">the_command</code>,
				<code class="constant">send_command</code>, <code class="constant">command_was_sent</code>, and
				<code class="constant">error_communication_timed_out</code>.  Once <code class="constant">the_command</code> lines have
				been set to the desired value, the <code class="constant">send_command</code> line is driven high, and the
				command transmission commences. The <code class="constant">send_command</code> line has to be kept high for at
				least one clock cycle. After the command transmission is complete.  either the
				<code class="constant">command_was_sent</code> or the <code class="constant">error_communication_timed_out</code> signal
				is activated, which indicate a transmission success or failure, respectively. These status signals are
				held until either the <code class="constant">send_command</code> line is de-asserted, or for one clock cycle,
				whichever is less. The protocol timing is illustrated in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#figps2send" title="Figure 3. Timing diagram for sending commands">Figure&nbsp;3, “Timing diagram for sending commands”</a>.</p><div class="figure"><a id="figps2send"></a><p class="title"><b>Figure&nbsp;3.&nbsp;Timing diagram for sending commands</b></p><div class="figure-contents"><div><img src="./PS_2 Controller_files/ps2_send.png" alt="Timing diagram for sending commands"></div></div></div><br class="figure-break"></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id439258"></a>PS/2 Keyboard protocol</h2></div></div></div><p>The PS/2 keyboard communicates through the bi-directional half-duplex line. When the line is idle, the keyboard may send
			the data consisting of 8 bit words and representing the <a class="link" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#apkeycodes" title="A. List of key codes">key codes</a>. Additionally, there is a set of commands that
			may be exchanged between the host and the keyboard. The host has priority over the communication line (i.e., command
			may be sent at any time and there will be no key codes transmitted until the command finishes).</p><p>Although the keyboard will operate properly without any configuration, the user may wish to change certain
			parameters (e.g., instruct the keyboard
			to turn on/off the status LEDs or change the key repeat rate). This can be performed by sending the appropriate command to the keyboard, as described
			in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#hostkbdcomm" title="Host-to-Keyboard communication">the section called “Host-to-Keyboard communication”</a>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id478856"></a>Keyboard-to-Host communication</h3></div></div></div><p>The keyboard will send a code consisting of one or more 8 bit words whenever the key is pressed, held down, or released.
				The codes for the conventional keyboard are listed in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#apkeycodes" title="A. List of key codes">Appendix&nbsp;A, <i>List of key codes</i></a>. "Make" code is sent when the key is pressed down, and repeated periodically
				if the key is held down. The "break" code is sent when the key is released. The codes will appear on the <code class="constant">received_data</code>
				port of the PS/2 controller as they are received. It is the user's responsibility to check the code before it is overwritten.</p><p>In addition to the key codes, the keyboard might also send commands to the host. The most common commands are listed in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#kbdcmd" title="Table 1. Keyboard-to-host commands">Table&nbsp;1, “Keyboard-to-host commands”</a>.</p><div class="table"><a id="kbdcmd"></a><p class="title"><b>Table&nbsp;1.&nbsp;Keyboard-to-host commands</b></p><div class="table-contents"><table summary="Keyboard-to-host commands" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Code (hexadecimal)</th><th align="left">Command</th></tr></thead><tbody><tr><td align="left">FA</td><td align="left">Acknowledge</td></tr><tr><td align="left">AA</td><td align="left">Self Test Passed</td></tr><tr><td align="left">EE</td><td align="left">Echo response</td></tr><tr><td align="left">FE</td><td align="left">Resend request</td></tr><tr><td align="left">00</td><td align="left">Error</td></tr><tr><td align="left">FF</td><td align="left">Error</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="hostkbdcomm"></a>Host-to-Keyboard communication</h3></div></div></div><p>The host may send the commands to the keyboard to control its
				behavior. The most common commands are described in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#kbdhostcmd" title="Table 2. Host-to-keyboard commands">Table&nbsp;2, “Host-to-keyboard commands”</a>, and
				you may refer to <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#ce" title="PS/2 physical protocol and interface">[ce]</a> for an exhaustive list.</p><p>Command transmission takes precedence over the data
				transmission from the keyboard, and will inhibit the transmission of any key
				codes. Instead, the keyboard will transmit an acknowledge code upon receiving
				the command. The PS/2 controller provides a simple interface to send the
				commands, as described in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#ifdesc" title="Interface description">the section called “Interface description”</a>.</p><div class="table"><a id="kbdhostcmd"></a><p class="title"><b>Table&nbsp;2.&nbsp;Host-to-keyboard commands</b></p><div class="table-contents"><table summary="Host-to-keyboard commands" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Code (hexadecimal)</th><th align="left">Command</th></tr></thead><tbody><tr><td align="left">ED</td><td align="left">Set status LEDs - This command can be used to
								turn on and off the Num Lock, Caps Lock and Scroll Lock LEDs.
								After receiving this command, the keyboard will reply with an ACK (FA) and wait for another byte which
								determines the status of the LEDs. Bit 0 controls the Scroll Lock, bit 1 controls the Num Lock and
								Bit 2 controls the Caps lock. Bits 3 to 7 are ignored.</td></tr><tr><td align="left">EE</td><td align="left">Echo - The keyboard should reply with an Echo (EE) upon receiving this command.</td></tr><tr><td align="left">F0</td><td align="left">Set scan code set - Upon receiving F0, the keyboard will
								reply with an ACK (FA) and wait for another byte. This byte can be in the range 01 to 03, and it determines the scan
								code set to be used. Sending 00 as the second byte will return the scan code set currently in use.</td></tr><tr><td align="left">F3</td><td align="left">Set repeat rate -
								The keyboard will acknowledge the command with an ACK (FA) and wait for the second byte which
								determines the repeat rate. Refer to <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#ce" title="PS/2 physical protocol and interface">[ce]</a> for more information.</td></tr><tr><td align="left">F4</td><td align="left">Keyboard Enable - Clears the output buffer, enables the keyboard (i.e., key codes will be transmitted) and returns an ACK.</td></tr><tr><td align="left">F5</td><td align="left">Keyboard Disable - Resets the keyboard, disables the keyboard (key codes will not be transmitted) and returns an ACK.</td></tr><tr><td align="left">FE</td><td align="left">Resend - Upon receipt of the resend command the keyboard will retransmit the last byte sent.</td></tr><tr><td align="left">FF</td><td align="left">Reset - Resets the keyboard.</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="mousepr"></a>PS/2 Mouse protocol</h2></div></div></div><p>The PS/2 mouse operates in the similar manner as the PS/2 keyboard, except the data packets are different.
			The mouse sends the data using 3 byte packets. Every packet consists of the relative movement since the last transmission
			and the button state. Additionally, there is a set of commands that the host may send to the mouse to control its operating
			modes.</p><p>This document describes the basic features of the mouse protocol. These features are sufficient for the most common uses of the mouse,
			but should you need an exhaustive listing, refer to <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#ce" title="PS/2 physical protocol and interface">[ce]</a>.</p><p>After power-on, or the reset command, the mouse will enter the reset mode, where it will perform the self-test, report the success or failure,
			and then transmit the device ID, which is always zero. After the self-test, the operating parameters will be set as described in
			<a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousedefparam" title="Table 3. Default parameters">Table&nbsp;3, “Default parameters”</a>.</p><div class="table"><a id="mousedefparam"></a><p class="title"><b>Table&nbsp;3.&nbsp;Default parameters</b></p><div class="table-contents"><table summary="Default parameters" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Name</th><th align="left">Value</th></tr></thead><tbody><tr><td align="left">Sampling rate</td><td align="left">100 samples/s</td></tr><tr><td align="left">Resolution</td><td align="left">4 counts/mm</td></tr><tr><td align="left">Data reporting</td><td align="left">disabled</td></tr></tbody></table></div></div><br class="table-break"><p>By default, the mouse enters the streaming mode after reset. In this mode, the mouse will send the movement packets whenever it detects
			a movement or the change in button state. <span class="emphasis"><em>However, please note that the data will not be sent by the mouse by default.</em></span> You must enable
			the reporting by sending the "Enable Data Reporting" command as described in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousehostcmd" title="Table 6. Host-to-mouse commands">Table&nbsp;6, “Host-to-mouse commands”</a>. Although there are other operating modes
			present in the protocol, streaming mode is the most useful and is the only mode discussed in this document.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id479181"></a>Mouse-to-host communication</h3></div></div></div><p>When in the streaming mode of operation, mouse will periodically send the data packets containing the following information:</p><div class="itemizedlist"><ul type="disc"><li><p>Button state - 3 bits representing the state of the left, right and middle buttons.</p></li><li><p>Relative position - two 9-bit 2's-complement numbers representing the amount of movement that has occurred since the last
						transmission</p></li></ul></div><p>Data packet format is illustrated in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousedata" title="Table 4. Mouse data packet">Table&nbsp;4, “Mouse data packet”</a>.</p><div class="table"><a id="mousedata"></a><p class="title"><b>Table&nbsp;4.&nbsp;Mouse data packet</b></p><div class="table-contents"><table summary="Mouse data packet" border="1"><colgroup><col><col align="left"><col><col><col><col><col><col><col align="left"></colgroup><thead><tr><th align="left">&nbsp;</th><th align="left">Bit 7</th><th align="left">Bit 6</th><th align="left">Bit 5</th><th align="left">Bit 4</th><th align="left">Bit 3</th><th align="left">Bit 2</th><th align="left">Bit 1</th><th align="left">Bit 0</th></tr></thead><tbody><tr><td align="left">Byte 0</td><td align="left">Y overflow</td><td align="left">X overflow</td><td align="left">Y sign</td><td align="left">X sign</td><td align="left">Always 1</td><td align="left">Middle button</td><td align="left">Right button</td><td align="left">Left button</td></tr><tr><td align="left">Byte 1</td><td colspan="8" align="center">X movement</td></tr><tr><td align="left">Byte 2</td><td colspan="8" align="center">Y movement</td></tr></tbody></table></div></div><br class="table-break"><p>The mouse has two internal counters to keep track of the relative position. The counters are incremented/decremented every time the mouse
				is moved. The counter step with respect to the physical distance depends on the resolution (which can be changed as described in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#ce" title="PS/2 physical protocol and interface">[ce]</a>), with the
				default being 4 counts/mm. The counters are reset every time the position data is transmitted to the host.</p><p>In addition to the data packets, the mouse may also send the commands described in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousecmd" title="Table 5. Mouse-to-host commands">Table&nbsp;5, “Mouse-to-host commands”</a>.</p><div class="table"><a id="mousecmd"></a><p class="title"><b>Table&nbsp;5.&nbsp;Mouse-to-host commands</b></p><div class="table-contents"><table summary="Mouse-to-host commands" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Code (hexadecimal)</th><th align="left">Command</th></tr></thead><tbody><tr><td align="left">FA</td><td align="left">Acknowledge</td></tr><tr><td align="left">AA</td><td align="left">Self Test Passed</td></tr><tr><td align="left">FC</td><td align="left">Self Test Failed</td></tr><tr><td align="left">00</td><td align="left">Device ID. Sent immediately after the self test status command and is always 0x00</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id479420"></a>Host-to-mouse communication</h3></div></div></div><p>The host may send the commands to the mouse to control its operating modes and other parameters. The most useful commands are described in <a class="xref" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/ps2.html#mousehostcmd" title="Table 6. Host-to-mouse commands">Table&nbsp;6, “Host-to-mouse commands”</a>.
				If the mouse is in streaming mode, the host should disable the data reporting prior to sending any other commands. The mouse will acknowledge every command.</p><div class="table"><a id="mousehostcmd"></a><p class="title"><b>Table&nbsp;6.&nbsp;Host-to-mouse commands</b></p><div class="table-contents"><table summary="Host-to-mouse commands" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Code (hexadecimal)</th><th align="left">Command</th></tr></thead><tbody><tr><td align="left">FF</td><td align="left">Reset</td></tr><tr><td align="left">F6</td><td align="left">Reset without self-test</td></tr><tr><td align="left">FE</td><td align="left">Resend the last byte</td></tr><tr><td align="left">F4</td><td align="left">Enable data reporting - the mouse will start transmitting the movement packets</td></tr><tr><td align="left">F5</td><td align="left">Disable data reporting - the mouse will stop transmitting the movement packets</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id479502"></a>PS/2 Controller Demonstration</h2></div></div></div><p>You can find an example design using the PS/2 controller <a class="ulink" href="https://www.eecg.utoronto.ca/~jayar/ece241_08F/AudioVideoCores/ps2/src/PS2_Demo.zip" target="_top">here</a>. This is
			the ready to use Quartus project. The .sof file is also included.</p><p>The operation of the circuit is very simple - the <code class="constant">received_data</code> port of the PS/2 controller is connected to the two
			HEX displays through a decoder, so that you can see the hexadecimal 8 bit value of the code. Whenever some data is received, it is displayed on the HEX display,
			and stays there until the next word of data is received. For example, if you connect the PS/2 keyboard to the controller, the key codes will be displayed
			as you press the keys.</p></div><div class="bibliography"><div class="titlepage"><div><div><h2 class="title"><a id="id479527"></a>Useful websites</h2></div></div></div><div class="biblioentry"><a id="ce"></a><p>[ce] <span class="title"><i>PS/2 physical protocol and interface</i>. </span><span class="publisher"><span class="publishername"><a class="ulink" href="http://www.computer-engineering.org/" target="_top">http://www.computer-engineering.org/</a>. </span></span></p></div><div class="biblioentry"><a id="bl"></a><p>[bl] <span class="title"><i>Interfacing the PC's keyboard</i>. </span><span class="publisher"><span class="publishername"><a class="ulink" href="http://www.beyondlogic.org/keyboard/keybrd.htm" target="_top">http://www.beyondlogic.org/keyboard/keybrd.htm</a>. </span></span></p></div></div><div class="appendix" lang="en" xml:lang="en"><h2 class="title" style="clear: both"><a id="apkeycodes"></a>A.&nbsp;List of key codes</h2><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id487726"></a>Graphic keys-to-keycodes map</h3></div></div></div><p>Key names are on top, with the hexadecimal make code below.</p><div class="figure"><a id="id503911"></a><p class="title"><b>Figure&nbsp;A.1.&nbsp;Keycode map</b></p><div class="figure-contents"><div><img src="./PS_2 Controller_files/keycodes.png" alt="Keycode map"></div></div></div><br class="figure-break"></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id505427"></a>Keycode tables</h3></div></div></div><div class="table"><a id="id507023"></a><p class="title"><b>Table&nbsp;A.1.&nbsp;Standard PS/2 Keycodes, default set (set 2)</b></p><div class="table-contents"><table summary="Standard PS/2 Keycodes, default set (set 2)" border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th align="left">KEY   </th><th align="left">MAKE     </th><th align="left">BREAK   </th><th align="left">KEY   </th><th align="left">MAKE     </th><th align="left">BREAK   </th></tr></thead><tbody><tr><td align="left"> A    </td><td align="left"> 1C      </td><td align="left">F0,1C   </td><td align="left">R ALT </td><td align="left">  E0,11  </td><td align="left">E0,F0,11</td></tr><tr><td align="left"> B    </td><td align="left"> 32      </td><td align="left">F0,32   </td><td align="left"> APPS </td><td align="left">  E0,2F  </td><td align="left">E0,F0,2F</td></tr><tr><td align="left"> C    </td><td align="left"> 21      </td><td align="left">F0,21   </td><td align="left">ENTER </td><td align="left">   5A    </td><td align="left"> F0,5A  </td></tr><tr><td align="left"> D    </td><td align="left"> 23      </td><td align="left">F0,23   </td><td align="left"> ESC  </td><td align="left">   76    </td><td align="left"> F0,76  </td></tr><tr><td align="left"> E    </td><td align="left"> 24      </td><td align="left">F0,24   </td><td align="left">  F1  </td><td align="left">   05    </td><td align="left"> F0,05  </td></tr><tr><td align="left"> F    </td><td align="left"> 2B      </td><td align="left">F0,2B   </td><td align="left">  F2  </td><td align="left">   06    </td><td align="left"> F0,06  </td></tr><tr><td align="left"> G    </td><td align="left"> 34      </td><td align="left">F0,34   </td><td align="left">  F3  </td><td align="left">   04    </td><td align="left"> F0,04  </td></tr><tr><td align="left"> H    </td><td align="left"> 33      </td><td align="left">F0,33   </td><td align="left">  F4  </td><td align="left">   0C    </td><td align="left"> F0,0C  </td></tr><tr><td align="left"> I    </td><td align="left"> 43      </td><td align="left">F0,43   </td><td align="left">  F5  </td><td align="left">   03    </td><td align="left"> F0,03  </td></tr><tr><td align="left"> J    </td><td align="left"> 3B      </td><td align="left">F0,3B   </td><td align="left">  F6  </td><td align="left">   0B    </td><td align="left"> F0,0B  </td></tr><tr><td align="left"> K    </td><td align="left"> 42      </td><td align="left">F0,42   </td><td align="left">  F7  </td><td align="left">   83    </td><td align="left"> F0,83  </td></tr><tr><td align="left"> L    </td><td align="left"> 4B      </td><td align="left">F0,4B   </td><td align="left">  F8  </td><td align="left">   0A    </td><td align="left"> F0,0A  </td></tr><tr><td align="left"> M    </td><td align="left"> 3A      </td><td align="left">F0,3A   </td><td align="left">  F9  </td><td align="left">   01    </td><td align="left"> F0,01  </td></tr><tr><td align="left"> N    </td><td align="left"> 31      </td><td align="left">F0,31   </td><td align="left"> F10  </td><td align="left">   09    </td><td align="left"> F0,09  </td></tr><tr><td align="left"> O    </td><td align="left"> 44      </td><td align="left">F0,44   </td><td align="left"> F11  </td><td align="left">   78    </td><td align="left"> F0,78  </td></tr><tr><td align="left"> P    </td><td align="left"> 4D      </td><td align="left">F0,4D   </td><td align="left"> F12  </td><td align="left">   07    </td><td align="left"> F0,07  </td></tr><tr><td align="left"> Q    </td><td align="left"> 15      </td><td align="left">F0,15   </td><td align="left">SCROLL</td><td align="left">   7E    </td><td align="left"> F0,7E  </td></tr><tr><td align="left"> R    </td><td align="left"> 2D      </td><td align="left">F0,2D   </td><td align="left">  [   </td><td align="left"> 54      </td><td align="left"> FO,54  </td></tr><tr><td align="left"> S    </td><td align="left"> 1B      </td><td align="left">F0,1B   </td><td align="left">INSERT</td><td align="left">E0,70    </td><td align="left">E0,F0,70</td></tr><tr><td align="left"> T    </td><td align="left"> 2C      </td><td align="left">F0,2C   </td><td align="left"> HOME </td><td align="left">E0,6C    </td><td align="left">E0,F0,6C</td></tr><tr><td align="left"> U    </td><td align="left"> 3C      </td><td align="left">F0,3C   </td><td align="left">PG UP </td><td align="left">E0,7D    </td><td align="left">E0,F0,7D</td></tr><tr><td align="left"> V    </td><td align="left"> 2A      </td><td align="left">F0,2A   </td><td align="left">DELETE</td><td align="left">E0,71    </td><td align="left">E0,F0,71</td></tr><tr><td align="left"> W    </td><td align="left"> 1D      </td><td align="left">F0,1D   </td><td align="left"> END  </td><td align="left">E0,69    </td><td align="left">E0,F0,69</td></tr><tr><td align="left"> X    </td><td align="left"> 22      </td><td align="left">F0,22   </td><td align="left">PG DN </td><td align="left">E0,7A    </td><td align="left">E0,F0,7A</td></tr><tr><td align="left"> Y    </td><td align="left"> 35      </td><td align="left">F0,35   </td><td align="left">  UP  </td><td align="left">E0,75    </td><td align="left">E0,F0,75</td></tr><tr><td align="left"> Z    </td><td align="left"> 1A      </td><td align="left">F0,1A   </td><td align="left"> LEFT </td><td align="left">E0,6B    </td><td align="left">E0,F0,6B</td></tr><tr><td align="left"> 0    </td><td align="left"> 45      </td><td align="left">F0,45   </td><td align="left"> DOWN </td><td align="left">E0,72    </td><td align="left">E0,F0,72</td></tr><tr><td align="left"> 1    </td><td align="left"> 16      </td><td align="left">F0,16   </td><td align="left">RIGHT </td><td align="left">E0,74    </td><td align="left">E0,F0,74</td></tr><tr><td align="left"> 2    </td><td align="left"> 1E      </td><td align="left">F0,1E   </td><td align="left"> NUM  </td><td align="left"> 77      </td><td align="left"> F0,77  </td></tr><tr><td align="left"> 3    </td><td align="left"> 26      </td><td align="left">F0,26   </td><td align="left"> KP / </td><td align="left">E0,4A    </td><td align="left">E0,F0,4A</td></tr><tr><td align="left"> 4    </td><td align="left"> 25      </td><td align="left">F0,25   </td><td align="left"> KP * </td><td align="left"> 7C      </td><td align="left"> F0,7C  </td></tr><tr><td align="left"> 5    </td><td align="left"> 2E      </td><td align="left">F0,2E   </td><td align="left"> KP - </td><td align="left"> 7B      </td><td align="left"> F0,7B  </td></tr><tr><td align="left"> 6    </td><td align="left"> 36      </td><td align="left">F0,36   </td><td align="left"> KP + </td><td align="left"> 79      </td><td align="left"> F0,79  </td></tr><tr><td align="left"> 7    </td><td align="left"> 3D      </td><td align="left">F0,3D   </td><td align="left">KP EN </td><td align="left">E0,5A    </td><td align="left">E0,F0,5A</td></tr><tr><td align="left"> 8    </td><td align="left"> 3E      </td><td align="left">F0,3E   </td><td align="left"> KP . </td><td align="left"> 71      </td><td align="left"> F0,71  </td></tr><tr><td align="left">  9   </td><td align="left">   46    </td><td align="left"> F0,46  </td><td align="left"> KP 0 </td><td align="left"> 70      </td><td align="left"> F0,70  </td></tr><tr><td align="left">  `   </td><td align="left">   0E    </td><td align="left"> F0,0E  </td><td align="left"> KP 1 </td><td align="left"> 69      </td><td align="left"> F0,69  </td></tr><tr><td align="left">  -   </td><td align="left">   4E    </td><td align="left"> F0,4E  </td><td align="left"> KP 2 </td><td align="left"> 72      </td><td align="left"> F0,72  </td></tr><tr><td align="left">  =   </td><td align="left">   55    </td><td align="left"> FO,55  </td><td align="left"> KP 3 </td><td align="left"> 7A      </td><td align="left"> F0,7A  </td></tr><tr><td align="left">  \   </td><td align="left">   5D    </td><td align="left"> F0,5D  </td><td align="left"> KP 4 </td><td align="left"> 6B      </td><td align="left"> F0,6B  </td></tr><tr><td align="left"> BKSP </td><td align="left">   66    </td><td align="left"> F0,66  </td><td align="left"> KP 5 </td><td align="left"> 73      </td><td align="left"> F0,73  </td></tr><tr><td align="left">SPACE </td><td align="left">   29    </td><td align="left"> F0,29  </td><td align="left"> KP 6 </td><td align="left"> 74      </td><td align="left"> F0,74  </td></tr><tr><td align="left"> TAB  </td><td align="left">   0D    </td><td align="left"> F0,0D  </td><td align="left"> KP 7 </td><td align="left"> 6C      </td><td align="left"> F0,6C  </td></tr><tr><td align="left"> CAPS </td><td align="left">   58    </td><td align="left"> F0,58  </td><td align="left"> KP 8 </td><td align="left"> 75      </td><td align="left"> F0,75  </td></tr><tr><td align="left">L SHFT</td><td align="left">   12    </td><td align="left"> FO,12  </td><td align="left"> KP 9 </td><td align="left"> 7D      </td><td align="left"> F0,7D  </td></tr><tr><td align="left">L CTRL</td><td align="left">   14    </td><td align="left"> FO,14  </td><td align="left">  ]   </td><td align="left"> 5B      </td><td align="left"> F0,5B  </td></tr><tr><td align="left">L GUI </td><td align="left">  E0,1F  </td><td align="left">E0,F0,1F</td><td align="left">  ;   </td><td align="left"> 4C      </td><td align="left"> F0,4C  </td></tr><tr><td align="left">L ALT </td><td align="left">   11    </td><td align="left"> F0,11  </td><td align="left">  '   </td><td align="left"> 52      </td><td align="left"> F0,52  </td></tr><tr><td align="left">R SHFT</td><td align="left">   59    </td><td align="left"> F0,59  </td><td align="left">  ,   </td><td align="left"> 41      </td><td align="left"> F0,41  </td></tr><tr><td align="left">R CTRL</td><td align="left">  E0,14  </td><td align="left">E0,F0,14</td><td align="left">  .   </td><td align="left"> 49      </td><td align="left"> F0,49  </td></tr><tr><td align="left">R GUI </td><td align="left">  E0,27  </td><td align="left">E0,F0,27</td><td align="left">  /   </td><td align="left"> 4A      </td><td align="left"> F0,4A  </td></tr></tbody></table></div></div><br class="table-break"></div></div></div>
</body></html>